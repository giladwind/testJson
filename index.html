<html>

<head>
    <title> test </title>
</head>

<body>
    <script>
        let tmp = {
            prop1: 'string',
            prop2: -123,
            prop4: new Date(Date.now()),
            prop5: [1, 2, 3, 4, 5, "sdfsdf"],
            prop6: { name: 'gilad', test: 123 },
            prop7: [{ name: 'gilad1', test: 123 }, { name: 'gilad2', test: 123 }, { name: 'gilad3', test: 123 }]
        };
        
        let jsonString = `{prop1:"string","prop2": -123 ,"prop4":"2019-03-24T10:17:12.538Z","prop5":[1,2,3,4,5],"prop6":{"name":"gilad","test":123},"prop7":[{"name":"gilad1","test":123},{"name":"gilad2","test":123},{"name":"gilad3","test":123}]}`;

        var handlerArray = [];

        /* create value parsing handler object */
        function CreateHandler(openChar, handler, description) {
            this.openChar = openChar;
            this.handler = handler;
            this.description = description;
            this.isHandeling = (testVal) => { return this.openChar.indexOf(testVal) !== -1; }
        }
        /* string start */
        function getStringValue(stringData, startIndex) {
            let openChar = stringData[startIndex];
            let counter = 1;
            let foundEndString = false;
            while (foundEndString === false && startIndex + counter < stringData.length) {
                if (stringData[startIndex + counter] === stringData[startIndex] && stringData[startIndex + counter - 1] !== '\\') foundEndString = true;
                else counter++;
            }
            return { value: stringData.substr(startIndex + 1, counter - 1), length: counter + 1 };
        }
        handlerArray.push(new CreateHandler('\'"', getStringValue, 'String'));
        /* string end */
        /* number start */
        var numbers = "1234567890.-+";
        function getNumberValue(stringData, startIndex) {
            let isFloat = false;
            let counter = 0;
            while (numbers.indexOf(stringData[startIndex + counter]) !== -1 && startIndex + counter < stringData.length) {
                if (stringData[startIndex + counter] === '.') isFloat = true;
                counter++;
            }
            let numberString = stringData.substr(startIndex, counter);
            return { value: isFloat ? Number.parseFloat(numberString) : Number.parseInt(numberString), length: counter  };
        }
        handlerArray.push(new CreateHandler(numbers, getNumberValue, 'Number'));
        /* number end */


        /* array start */
        function getArrayValue(stringData, startIndex) {
            
            let retValue = [];
            let counter = 1;
            let endOfArrayFound = false;
            while (stringData && startIndex + counter < stringData.length && !endOfArrayFound) {
                while (stringData[startIndex + counter] === ' ') counter++;
                let valueObject = getValue(stringData, startIndex + counter);
                if (valueObject) {
                    retValue = [...retValue, valueObject.value];
                    counter += valueObject.length
                }
                else {
                    throw (`Error parsing object at index ${startIndex + counter}`);
                }
                while (stringData[startIndex + counter] === ' ') counter++;
                if (stringData[startIndex + counter] === ']') {
                    endOfArrayFound = true;
                }
                else if (stringData[startIndex + counter] === ',') {
                    counter++;
                }
                else {
                    throw (`Error parsing object at index ${startIndex + counter}`);
                }
            }
            
            return { value: retValue, length: counter +1 };
        }
        handlerArray.push(new CreateHandler('[', getArrayValue, 'Arrays'));
        /* array end  */

        function getValue(stringData, startIndex) {
            
            let counter = 0;
            while (stringData[startIndex + counter] === ' ') counter++;
            let handler = null;
            for (var i = 0; i < handlerArray.length && handler === null; i++) {
                handler = handlerArray[i].isHandeling(stringData[startIndex + counter]) ? handlerArray[i] : null;
            }
            if (handler) {
                var valueObject = handler.handler(stringData, startIndex + counter);

                if (valueObject) {
                    return valueObject;
                }
                else {
                    throw (`Error parsing object at index ${startIndex + counter}`);
                }
            }
            else {
                throw (`Error parsing object at index ${startIndex + counter}`);
            }
        }

        /* object Start */

        var propertyNameOpenChars = `"'`;
        var propertyNameErrorhars = `{[}]`;
        function getPropertyName(stringData, startIndex) {
            let counter = 0;
            let found = false;
            let hasError = false;

            while (!found && !hasError && startIndex + counter < stringData.length) {
                if (stringData[startIndex + counter] === ':') found = true;
                else if (propertyNameErrorhars.indexOf(stringData[startIndex + counter]) !== -1) hasError = true;
                else counter++;
            }
            if (!found | hasError) return null;
            let pnamePart = stringData.substr(startIndex, counter);
            if (propertyNameOpenChars.indexOf(pnamePart[0]) !== -1 && pnamePart[0] === pnamePart[pnamePart.length - 1]) {
                pnamePart = pnamePart.substr(1, pnamePart.length - 2);
            }
            return { name: pnamePart, length: counter + 1 };

        }

        function getObjectValue(stringData, startIndex) {
            let counter = 1;
            let retObject = {};
            let pname = null;
            let endOfObjectFound = false;
            while (stringData && startIndex + counter < stringData.length && !endOfObjectFound) {
                pname = getPropertyName(stringData, startIndex + counter);
                if (pname) {
                    counter += pname.length;
                    while (stringData[startIndex + counter] === ' ') counter++;
                    var valueObject = getValue(stringData, startIndex + counter);
                    retObject[pname.name] = valueObject.value;
                    counter += valueObject.length;
                }
                else {
                    while (stringData[startIndex + counter] === ' ') counter++;
                    endOfObjectFound = stringData[startIndex + counter] === '}';
                    if (!endOfObjectFound) {
                        throw (`Error parsing object at index ${startIndex + counter}`);
                    }

                }
                while (stringData[startIndex + counter] === ' ') counter++;
                if (stringData[startIndex + counter] === ',') {
                    counter++;
                }
                else if (stringData[startIndex + counter] === '}') {
                    endOfObjectFound = true;
                }
                else {
                    throw (`Error parsing object at index ${startIndex + counter}`);
                }
            }
            
            return { value: retObject, length: counter +1 };
        }

        handlerArray.push(new CreateHandler('{', getObjectValue, 'Objects'));
        /* object End */


        function JSONparse(stringData) {
            if (!stringData || typeof stringData !== 'string' || stringData.length === 0 || !stringData.startsWith('{')) {
                return null;
            }
            
            var valueObject = getObjectValue(stringData, 0);
            if(valueObject) return valueObject.value;
            return null;
            
            //let obj = ParseStringSection(stringData);
        }

       console.log( JSONparse(JSON.stringify({ name: 'gilad', number: 123, 'test': -44, obj: { inner1: 123 }, arr: [1, 2, 3] })));


       console.log(  JSONparse(jsonString));

    </script>
</body>

</html>